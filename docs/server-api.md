## Серверное API RentControl

Документ фиксирует перечень необходимых HTTP-эндпоинтов для мобильного приложения RentControl. Формат данных JSON. Аутентификация по Bearer-токену для всех эндпоинтов, кроме Auth.

Base URL: `/api/v1`

---

## Auth

- `POST /auth/register`  
  Регистрация пользователя по e-mail, инициирование отправки кода подтверждения (OTP).

- `POST /auth/confirm`  
  Подтверждение регистрации по OTP и активация учётной записи.

- `POST /auth/login`  
  Вход пользователя и выдача токенов сессии.

- `POST /auth/refresh`  
  Обновление access-токена по refresh-токену.

- `POST /auth/logout`  
  Завершение текущей сессии (выход с устройства).

- `POST /auth/password/reset/request`  
  Запрос OTP для восстановления доступа.

- `POST /auth/password/reset/confirm`  
  Подтверждение OTP и установка нового пароля.

---

## Пользователь и настройки

- `GET /me`  
  Получение профиля текущего пользователя, роли и пользовательских настроек.

- `PATCH /me`  
  Обновление профиля и настроек пользователя, включая уведомления, язык и тему.

- `POST /me/sessions/logout-all`  
  Завершение всех активных сессий пользователя.

---

## Пользователи (администрирование и назначения)

- `GET /users`  
  Получение списка пользователей для назначения исполнителей и согласующих, с поддержкой поиска и фильтра по роли.

- `GET /users/{userId}`  
  Получение карточки пользователя для администрирования.

- `POST /users`  
  Создание пользователя администратором.

- `PATCH /users/{userId}`  
  Изменение данных пользователя администратором, включая роль и статус активности.

- `POST /users/{userId}/block`  
  Блокировка пользователя.

- `POST /users/{userId}/unblock`  
  Разблокировка пользователя.

---

## Справочники

- `GET /ref/roles`  
  Список ролей системы.

- `GET /ref/object-types`  
  Список типов объектов недвижимости.

- `GET /ref/occupancy-statuses`  
  Список статусов заселения.

- `GET /ref/defect-categories`  
  Список категорий дефектов.

- `GET /ref/defect-statuses`  
  Список статусов дефектов.

- `GET /ref/defect-priorities`  
  Список приоритетов дефектов.

- `GET /ref/expense-categories`  
  Список категорий расходов.

- `GET /ref/expense-statuses`  
  Список статусов расходов.

- `GET /ref/checklist-templates`  
  Список шаблонов чек-листов осмотров.

- `GET /ref/checklist-templates/{templateId}`  
  Получение структуры шаблона чек-листа, включая секции и пункты.

---

## Объекты недвижимости

- `GET /objects`  
  Список объектов с поддержкой поиска, фильтров и сортировки.

- `POST /objects`  
  Создание объекта недвижимости.

- `GET /objects/{objectId}`  
  Получение карточки объекта и агрегированных показателей.

- `PATCH /objects/{objectId}`  
  Редактирование объекта.

- `POST /objects/{objectId}/archive`  
  Архивация объекта.

- `POST /objects/{objectId}/unarchive`  
  Возврат объекта из архива.

- `GET /objects/{objectId}/activity`  
  Журнал активности по объекту, хронология событий.

---

## Арендаторы

- `GET /tenants`  
  Список арендаторов для выбора и привязки к объекту.

- `POST /tenants`  
  Создание арендатора.

- `GET /tenants/{tenantId}`  
  Карточка арендатора.

- `PATCH /tenants/{tenantId}`  
  Редактирование арендатора.

- `POST /objects/{objectId}/tenant/link`  
  Привязка арендатора к объекту.

- `POST /objects/{objectId}/tenant/unlink`  
  Отвязка арендатора от объекта.

---

## Осмотры

- `GET /inspections`  
  Список осмотров с фильтрами по объекту, статусу, исполнителю и периоду.

- `POST /inspections`  
  Создание осмотра, назначение исполнителя и шаблона чек-листа.

- `GET /inspections/{inspectionId}`  
  Детали осмотра, включая текущие результаты пунктов чек-листа и вложения.

- `PATCH /inspections/{inspectionId}`  
  Редактирование осмотра до начала выполнения, изменение времени, исполнителя, комментария.

- `POST /inspections/{inspectionId}/cancel`  
  Отмена осмотра с фиксацией причины.

- `POST /inspections/{inspectionId}/start`  
  Перевод осмотра в статус выполнения, фиксация времени начала.

- `POST /inspections/{inspectionId}/finish`  
  Завершение осмотра, фиксация итогового комментария и времени завершения, опциональное создание дефектов по проблемным пунктам.

- `POST /inspections/{inspectionId}/approve`  
  Утверждение результатов осмотра уполномоченным пользователем.

- `POST /inspections/{inspectionId}/reject`  
  Отклонение результата осмотра с указанием причины и возврат в состояние до утверждения, если используется сценарий возврата.

- `PATCH /inspections/{inspectionId}/checklist`  
  Обновление результатов чек-листа осмотра, включая статусы пунктов, комментарии и привязки вложений.

---

## Дефекты

- `GET /defects`  
  Список дефектов с фильтрами по объекту, статусу, приоритету, исполнителю, просрочке и поиску.

- `POST /defects`  
  Создание дефекта вручную или на основе данных осмотра.

- `GET /defects/{defectId}`  
  Карточка дефекта: описание, статус, исполнитель, дедлайн, вложения, комментарии и история.

- `PATCH /defects/{defectId}`  
  Изменение атрибутов дефекта, включая приоритет, дедлайн, категорию и назначение исполнителя.

- `POST /defects/{defectId}/status`  
  Смена статуса дефекта с опциональным комментарием.

- `POST /defects/{defectId}/comments`  
  Добавление комментария к дефекту с возможностью вложений.

---

## Расходы

Правило видимости: пользователь получает только свои расходы и расходы, где он является участником подтверждения.

- `GET /expenses`  
  Список расходов пользователя с фильтрами по объекту, категории, типу (план/факт), статусу и периоду.

- `POST /expenses`  
  Создание расхода вручную, включая вложения чеков и настройки сценария подтверждения.

- `GET /expenses/{expenseId}`  
  Карточка расхода: детали, вложения, состояние подтверждений.

- `PATCH /expenses/{expenseId}`  
  Редактирование расхода автором до завершения подтверждений.

- `POST /expenses/{expenseId}/submit`  
  Перевод расхода из черновика в состояние “ожидает подтверждения”, если используется черновой сценарий.

- `POST /expenses/{expenseId}/approve`  
  Подтверждение расхода участником подтверждения.

- `POST /expenses/{expenseId}/reject`  
  Отклонение расхода участником подтверждения с комментарием.

- `POST /expenses/{expenseId}/cancel`  
  Отмена расхода автором.

---

## Приборы учёта и показания

- `GET /objects/{objectId}/meters`  
  Список приборов учёта объекта.

- `POST /objects/{objectId}/meters`  
  Добавление прибора учёта к объекту, если допускается в модели.

- `PATCH /objects/{objectId}/meters/{meterId}`  
  Редактирование прибора учёта, например название или единицы измерения.

- `GET /objects/{objectId}/meters/{meterId}/readings`  
  История показаний по прибору с пагинацией.

- `POST /objects/{objectId}/meters/{meterId}/readings`  
  Добавление нового показания, фиксация автора и даты.

---

## Вложения и медиа

- `POST /attachments`  
  Загрузка файла или медиа, получение идентификатора вложения для привязки к осмотрам, дефектам и расходам.

- `GET /attachments/{attachmentId}`  
  Получение метаданных вложения и ссылки для скачивания.

- `DELETE /attachments/{attachmentId}`  
  Удаление вложения, если разрешено ролью и если вложение не закреплено в утверждённых сущностях.

---

## Уведомления

- `GET /notifications`  
  Список уведомлений пользователя.

- `POST /notifications/{notificationId}/read`  
  Пометка уведомления как прочитанного.

- `POST /notifications/read-all`  
  Пометка всех уведомлений как прочитанных.

- `POST /push/token`  
  Регистрация push-токена устройства для доставки уведомлений.

- `DELETE /push/token`  
  Удаление push-токена устройства.

---

## Синхронизация и офлайн

- `POST /sync/batch`  
  Приём пачки офлайн-операций с уникальными идентификаторами, возвращение статусов применения операций и разрешение дублей.

- `GET /sync/since`  
  Получение изменений с момента указанной метки времени или версии для обновления локального кэша.

---

## Аудит и события

- `GET /audit/events`  
  Список событий аудита, доступный администратору, с фильтрами по сущности, периоду и автору.

- `GET /objects/{objectId}/audit/events`  
  Аудит по конкретному объекту.

- `GET /defects/{defectId}/audit/events`  
  Аудит по конкретному дефекту.

- `GET /inspections/{inspectionId}/audit/events`  
  Аудит по конкретному осмотру.

- `GET /expenses/{expenseId}/audit/events`  
  Аудит по конкретному расходу.
